<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- <link rel="stylesheet" href="/css/qnaDetail.css"> -->
    <link rel="icon" href="/images/7Tf1NS6R.ico" type="image/x-icon" sizes="32x32">
    <!-- <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script> -->
    <link rel="icon" href="../images/HotDog-Logo.png" type="image/x-icon" sizes="32x32">
    <title>게시글 상세 조회</title>
</head>
<style>
    body {
        font-family: 'Comic Sans MS', sans-serif;
        background-color: #f4e0d6;
        margin: 0;
        padding: 0;
    }

    .container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        margin-top: 20px;
    }

    h1 {
        text-align: center;
        color: #333;
    }

    .d-flex {
        justify-content: space-between;
        align-items: center;
    }

    .btn {
        margin-right: 10px;
    }

    label {
        font-weight: bold;
    }

    input[type="text"],
    textarea {
        width: 96%;
        padding: 10px;
        margin-bottom: 0px;
        border: 1px solid #ccc;
        border-radius: 4px;
        resize: none;
    }

    button {
        padding: 10px 20px;
        background-color: #DCADA4;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    #toggleCommentButton {
        margin: 20px auto;
        display: block;
    }

    .comment-container {
        display: none;
        max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    background-color: #fff;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    margin-top: 20px;
    }

    .comment-list {
        margin-top: 10px;
        white-space: pre-wrap;
    }
    #commentarea{
        overflow-y: scroll; 
        height:200px;
        border: 1px solid #ccc;
    }
    #commentarea p {
        margin-top: 10px;
        white-space: pre-wrap;
        background-color: #f9f9f9;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }
    /* 추가된 CSS: 768px 미만 화면에 대한 스타일링 */
    @media (max-width: 768px) {
        .container {
            padding: 10px; /* 좀 더 작은 padding 적용 */
            width: 475px;
        }

        input[type="text"],
        textarea {
            margin-bottom: 10px; /* 작은 간격으로 변경 */
            width: 95%;
        }

        button {
            padding: 8px 16px; /* 작은 크기로 변경 */
        }

        #comment-container {
            padding: 10px; /* 좀 더 작은 padding 적용 */
            width: 475px;
    border-radius: 8px;
        }
    }
    .writer {
        margin-top: 10px;
    }
    #toggleBtn_listBtn {
        display: flex;
    }
</style>
    <title>Q&A</title>
</head>

<body>
    <div class="container">
        <h1>Q&A</h1>
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <button id="editBtn" class="btn btn-primary" type="button" onclick="edit()">수정</button>
                <button id="deleteBtn" class="btn btn-danger" type="button" onclick="deleteBoards()">삭제</button>
            </div>
            <div class="writer">
                <label for="writer">작성자</label>
                <input type="text" id="writer" class="form-control" value="<%=data.writer%>" readonly>
            </div>
        </div>
        <label for="title">제목</label>
        <input type="text" id="title" class="form-control" value="<%=data.title%>"><br>
        <label for="contents">내용</label><br>
        <textarea id="contents" class="form-control" rows="10"><%=data.contents%></textarea>
        <button type="button" onclick="location.href='/boards/qna'">목록으로</button>
    </div>
    <div class="toggleBtn_listBtn">
    <button id="toggleCommentButton" class="btn btn-primary" onclick="toggleCommentForm()">댓글 보기</button>
</div>
    <div id="comment-container" class="comment-container"><br>
        <!-- <div class="comment-list"></div> -->
        <input type="hidden" id="boardtype" value="qna" />
        <input type="hidden" id="id" value="<%=data.id%>" />
        <input type="hidden" id="writer_other" value="<%=data.writer%>" readonly>
        <div class="form-group">
            <label for="comment-content">댓글</label><br>
            <textarea id="comment-content" class="form-control" rows="4" placeholder="댓글을 입력하세요"></textarea>
            <button class="btn btn-primary" onclick="postComment()">댓글 작성</button>
            <div id="commentarea"></div>
        </div>
    </div>
</div>
</body>
<!-- <input type="hidden" id="id" value="<%=data.id%>">
<label for="writer">작성자</label>
<input type="hidden" id="writer_other" value="<%=data.writer%>" readonly><br>
<label for="comment-content">댓글</label><br>
<textarea id="comment-content" rows="4" placeholder="댓글을 입력하세요"></textarea><br>
<button onclick="postComment()">댓글 작성</button> -->
<script>
    // 댓글 입력 폼을 토글하는 함수
    function toggleCommentForm() {
        var commentContainer = document.querySelector('#commentarea');
        var commentContainers = document.querySelector("#comment-container")
        if (commentContainer.style.display === 'none' || commentContainer.style.display === '' ||commentContainers.style.display === 'none' || commentContainers.style.display === '') {
            commentContainer.style.display = 'block';
            commentContainers.style.display = 'block';
        } else {
            commentContainer.style.display = 'none';
            commentContainers.style.display = 'none';
        }
    }
</script>

<script>
    const token = localStorage.getItem('token');
    const writer = document.querySelector('#writer').value
    const editBtn = document.getElementById("editBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const data = { token, writer };
    axios({
        method: 'POST',
        url: '/boards/verify',
        data
    }).then((res) => {
        console.log(res);
        if (!res.data.data) {
            editBtn.style.display = 'none'
            deleteBtn.style.display = 'none'
        }
    })

    // axios({
    //     method: 'GET',
    //     url: `/boards/comment/${document.getElementById("id").value}`
    // }).then(res => {
    //     console.log(res.data)
    //     const div = document.createElement('p')
    //     res.data.comments.forEach(value => {

    //         div.textContent += `${value.writerid}님의 댓글:${value.content}\n`
    //         commentarea.append(div);
    //     })
    // })
    axios({
        method: 'GET',
        url: `/boards/comment/${document.getElementById("id").value}`
    }).then(res => {
        console.log(res.data);
        const commentarea = document.querySelector('#commentarea'); // 댓글을 표시할 요소 선택
        res.data.comments.forEach(value => {
            const paragraph = document.createElement('p'); // <p> 요소 생성
            paragraph.textContent = `${value.writerid}님의 댓글: ${value.content}`;
            commentarea.appendChild(paragraph); // 각 댓글을 별도의 <p> 요소로 추가
        });
    });
    async function edit() {
        const id = document.getElementById("id").value;
        const title = document.getElementById("title").value;
        const contents = document.getElementById("contents").value;
        console.log(id)
        console.log(title)
        console.log(contents)
        try {
            if (!confirm("수정 하시겠습니까?")) {
                return;
            }
            const data = {
                id: Number(id),
                title: title,
                contents: contents,
            };
            const res = await axios({
                method: "PATCH",
                url: `/boards/qna/${id}`,
                data,
            })
            if (res.data.data) {
                alert(`${res.data.message}`);
                document.location.href = '/boards/qna';
            }
        } catch (error) {
            console.error(error);
            alert("수정 중 오류가 발생했습니다.");
        }
    }

    async function deleteBoards() {
        const id = document.getElementById("id").value;
        const data = { id }

        if (!confirm("삭제 하시겠습니까?")) {
            return;
        }

        try {
            const res = await axios({
                method: "DELETE",
                url: `/boards/qna/${id}`,
                data
            })
            console.log(res.data)
            if (res.data.data) {
                alert("삭제가 완료되었습니다.");
                document.location.href = '/boards/qna';
                return;
            }
        } catch (error) {
            console.error(error);
            alert("삭제 중 오류가 발생했습니다.");
            document.location.href = '/boards/qna';
            return;
        }
    }

    async function verify(writer) {
        const token = window.localStorage.getItem('token')
        //const id=document.querySelector('#writer')
        const data = {
            token, writer
        }
        try {
            const res = await axios({
                method: 'POST',
                url: "/boards/verify",
                data
            })
            console.log(res.data.data);
            if (!res.data.data) {
                alert(`${res.data.message}`)
                document.location.href = '/boards/qna'
            }

        } catch (error) {

        }
    }
    const b_t = document.querySelector('#boardtype')
    const writer_other = document.querySelector('#writer_other')
    const contents = document.querySelector('#comment-content')
    const commentarea = document.querySelector('#commentarea');
    const div = document.createElement('div')
    div.style.whiteSpace = 'pre-wrap';
    async function postComment() {
        const id = document.getElementById("id").value;
        console.log(b_t, writer, contents)
        const data = {
            writerid: writer_other.value,
            content: contents.value,
            boardtype: b_t.value,
            id
        }
        try {
            const res = await axios({
                method: 'POST',
                url: '/boards/comment/',
                data
            })
            if (res.data.data) {
                div.textContent += `${res.data.id}님의 댓글:${res.data.contents}\n`
                commentarea.append(div);
                contents.value = '';
            }

        } catch (error) {
            console.log(error);
        }
    }
</script>

</html>